<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fed Chair Challenge</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a202c; /* Dark background for the animation */
            color: #333;
            margin: 0;
            padding: 20px 0;
        }
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1; /* Place it behind all other content */
        }
        #game-container {
            width: 1100px;
            padding: 25px;
            background-color: rgba(255, 255, 255, 0.97); /* Slightly transparent */
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid #ddd;
            position: relative;
            margin: 20px auto;
        }
        h1, h2 {
            text-align: center;
            color: #1e3a5f;
            margin-bottom: 10px;
        }
        h1 {
            margin-bottom: 5px;
        }
        p.subtitle {
            text-align: center;
            margin-top: 0;
            margin-bottom: 5px;
            color: #666;
        }
        p.group-subtitle {
            text-align: center;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #888;
            font-style: italic;
        }
        .header-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        .header-buttons button {
            padding: 8px 16px;
            font-size: 0.9em;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #how-to-play-btn { background-color: #6c757d; }
        #how-to-play-btn:hover { background-color: #5a6268; }
        #cheat-btn { background-color: #ffc107; color: #212529; }
        #cheat-btn:hover { background-color: #e0a800; }
        #autopilot-quarter-btn { background-color: #17a2b8; }
        #autopilot-quarter-btn:hover { background-color: #138496; }
        #autopilot-victory-btn { background-color: #28a745; }
        #autopilot-victory-btn:hover { background-color: #218838; }


        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px 30px; border: 1px solid #888; width: 60%; max-width: 700px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; }
        .close-btn { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; }
        .close-btn:hover, .close-btn:focus { color: black; text-decoration: none; cursor: pointer; }
        .modal-content h3 { color: #1e3a5f; }
        .modal-content ul { list-style-type: disc; padding-left: 20px; }
        .modal-content li { margin-bottom: 10px; }
        .modal-content table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .modal-content th, .modal-content td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .modal-content th { background-color: #f2f2f2; color: #1e3a5f; }

        #stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat { background-color: #e9eef4; padding: 15px; border-radius: 8px; text-align: center; display: flex; flex-direction: column; justify-content: center; }
        .stat-label { font-weight: bold; font-size: 1.1em; color: #4a5568; }
        .stat-value { font-size: 2.2em; font-weight: bold; color: #1e3a5f; margin: 5px 0; }
        .stat-change { font-size: 1em; font-weight: bold; min-height: 1.2em; }
        .positive-change { color: #28a745; }
        .negative-change { color: #dc3545; }
        .neutral-change { color: #6c757d; }

        .policy-panel { margin-top: 20px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6; }
        .policy-controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; align-items: center; text-align: center; }
        .policy-control label { font-weight: bold; margin-bottom: 8px; font-size: 1.1em; }
        .policy-control input { padding: 8px; text-align: center; font-size: 1.2em; border: 1px solid #ccc; border-radius: 4px; width: 150px; margin: 0 auto; }
        
        .actions-panel { margin-top: 20px; display: flex; gap: 20px; }
        .actions-panel button { flex-grow: 1; padding: 15px; font-size: 1.2em; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        .actions-panel button:disabled { background-color: #6c757d; cursor: not-allowed; }
        #run-quarter-btn { background-color: #007bff; }
        #run-quarter-btn:hover:not(:disabled) { background-color: #0056b3; }
        #run-year-btn { background-color: #fd7e14; }
        #run-year-btn:hover:not(:disabled) { background-color: #e36803; }

        .info-panels { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; }
        .info-panel { padding: 15px; border-radius: 8px; min-height: 120px; }
        #economic-outlook { background-color: #e6f7ff; border: 1px solid #91d5ff; }
        #fomc-alerts { background-color: #fffbe6; border: 1px solid #ffeeba; }
        #advisor-hints { background-color: #e2f0e8; border: 1px solid #a3d9b8; }
        #fomc-alerts ul { padding-left: 20px; margin: 0; }
        #fomc-alerts li { color: #c54a09; font-weight: bold; }
    </style>
</head>
<body>

<div id="particles-js"></div>

<div id="game-container">
    <div class="header-buttons">
        <button id="autopilot-quarter-btn">Autopilot Next Quarter</button>
        <button id="autopilot-victory-btn">Autopilot to Victory</button>
        <button id="cheat-btn">Show Hint</button>
        <button id="how-to-play-btn">How to Play</button>
    </div>
    <h1>Fed Chair Challenge ðŸ¦…</h1>
    <p class="subtitle">Can you solve the 2025 Stagflation Crisis?</p>
    <p class="group-subtitle">Property of Group 7, Investment Analysis with DV and Gen AI</p>
    
    <div id="stats-grid">
        <div class="stat"><div class="stat-label">Quarters Elapsed</div><div class="stat-value" id="turn">0 / 12</div><div class="stat-change"></div></div>
        <div class="stat"><div class="stat-label">Economic Stability Index</div><div class="stat-value" id="stability">40</div><div class="stat-change"></div></div>
        <div class="stat"><div class="stat-label">US National Debt</div><div class="stat-value" id="national-debt">$38.0T</div><div class="stat-change"></div></div>
        <div class="stat"><div class="stat-label">GDP Growth (Annualized)</div><div class="stat-value" id="gdp-growth">-0.5%</div><div class="stat-change"></div></div>
        <div class="stat"><div class="stat-label">Unemployment Rate</div><div class="stat-value" id="unemployment">8.0%</div><div class="stat-change"></div></div>
        <div class="stat"><div class="stat-label">Inflation (CPI)</div><div class="stat-value" id="inflation">7.5%</div><div class="stat-change"></div></div>
        <div class="stat"><div class="stat-label">Federal Funds Rate</div><div class="stat-value" id="fed-rate">4.50%</div><div class="stat-change"></div></div>
        <div class="stat"><div class="stat-label">10-Year Treasury Yield</div><div class="stat-value" id="bond-yield">5.85%</div><div class="stat-change"></div></div>
    </div>
    
    <div class="info-panels">
        <div id="economic-outlook" class="info-panel"><h2>Economic Outlook</h2><p id="outlook-text">Welcome, Chair. The US is in a severe stagflation crisis. Your leadership is needed now.</p></div>
        <div id="fomc-alerts" class="info-panel"><h2>FOMC Economic Alerts</h2><div id="alerts-text"><p>Stagflation Warning: High inflation combined with negative growth is crippling the economy.</p></div></div>
        <div id="advisor-hints" class="info-panel"><h2>Advisor Hints</h2><p id="hints-text">Hint: Stagflation presents a difficult trade-off. You must decide whether to fight inflation first, or fight the recession.</p></div>
    </div>

    <div class="policy-panel">
        <h2>FOMC & Government Policy Levers</h2>
        <div class="policy-controls">
            <div class="policy-control"><label for="fed-rate-input">Set Federal Funds Rate (%)</label><input type="number" id="fed-rate-input" step="0.25" value="4.50"></div>
            <div class="policy-control"><label for="tariffs-input">Set Average Tariff Rate (%)</label><input type="number" id="tariffs-input" step="0.5" value="3.0"></div>
            <div class="policy-control"><label for="fiscal-input">Fiscal Spending Adj. ($B/Qtr)</label><input type="number" id="fiscal-input" step="10" value="0"></div>
        </div>
    </div>

    <div class="actions-panel">
        <button id="run-quarter-btn" onclick="runSimulation(1)">Advance 1 Quarter</button>
        <button id="run-year-btn" onclick="runSimulation(4)">Advance 4 Quarters (1 Year)</button>
    </div>

</div>

<div id="rules-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn" id="rules-close-btn">&times;</span>
    <h2>How to Play: The 2025 Stagflation Crisis</h2>
    <p>Your goal is to solve the economic crisis and achieve a "soft landing" within <strong>12 quarters (3 years)</strong>.</p>
    <h3>Win Condition</h3>
    <p>You win the game the moment you meet all three of these targets simultaneously:</p>
    <ul>
        <li><b>Inflation</b> is between <strong>1.5%</strong> and <strong>3.0%</strong></li>
        <li><b>Unemployment</b> is at or below <strong>5.0%</strong></li>
        <li><b>GDP Growth</b> is at or above <strong>1.5%</strong></li>
    </ul>
    <h3>Scoring &amp; Loss Condition</h3>
    <ul>
       <li>Your final score is calculated upon victory and is based on the health of the final economy. You get a bonus for finishing early.</li>
       <li>You lose if you cannot achieve the win condition by the end of the 12th quarter.</li>
    </ul>
    <h3>Getting Help</h3>
    <p>The <strong>"Show Hint"</strong> button reveals the winning strategy. The <strong>"Autopilot"</strong> buttons will automatically apply the correct moves for you, guaranteeing a win.</p>
  </div>
</div>

<div id="cheat-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn" id="cheat-close-btn">&times;</span>
    <h2>Psst psst...</h2>
    <p>This is a pre-calculated path to victory that is guaranteed to work with the simulation's model.</p>
    <table id="cheat-sheet-table"></table>
  </div>
</div>


<script>
// --- GAME STATE & CONSTANTS ---
const MAX_QUARTERS = 12;
let gameState = {
    quartersElapsed: 0, gameOver: false, stability: 40, nationalDebt: 38.0,
    gdpGrowth: -0.5, unemployment: 8.0, inflation: 7.5, fedRate: 4.5, bondYield: 5.85, tariffs: 3.0
};

const indicatorsMap = {
    stability: 'stability', nationalDebt: 'national-debt', gdpGrowth: 'gdp-growth',
    unemployment: 'unemployment', inflation: 'inflation', fedRate: 'fed-rate', bondYield: 'bond-yield'
};

// ** FINAL, FULLY-TESTED CHEAT SHEET **
const cheatSheet = [
    { quarter: 1, fedRate: 6.5, fiscal: -20, tariffs: 3.0, note: "Hike rates to fight inflation." },
    { quarter: 2, fedRate: 7.0, fiscal: -20, tariffs: 3.0, note: "Continue hiking to ensure inflation peaks." },
    { quarter: 3, fedRate: 6.5, fiscal: 0, tariffs: 3.0, note: "Hold rates high as inflation falls." },
    { quarter: 4, fedRate: 5.0, fiscal: 20, tariffs: 3.0, note: "Begin the pivot as inflation recedes." },
    { quarter: 5, fedRate: 4.0, fiscal: 50, tariffs: 3.0, note: "Cut rates and boost stimulus." },
    { quarter: 6, fedRate: 3.5, fiscal: 60, tariffs: 3.0, note: "More stimulus to lower unemployment." },
    { quarter: 7, fedRate: 3.0, fiscal: 80, tariffs: 3.0, note: "Accelerate the recovery." },
    { quarter: 8, fedRate: 2.75, fiscal: 60, tariffs: 3.0, note: "Continue strong support." },
    { quarter: 9, fedRate: 2.5, fiscal: 40, tariffs: 3.0, note: "Ease off stimulus as economy strengthens." },
    { quarter: 10, fedRate: 2.5, fiscal: 20, tariffs: 3.0, note: "Aim for stable growth." },
    { quarter: 11, fedRate: 2.75, fiscal: 0, tariffs: 3.0, note: "Normalize policy to secure the win." },
    { quarter: 12, fedRate: 2.75, fiscal: 0, tariffs: 3.0, note: "Maintain stability." }
];

// --- UI FUNCTIONS ---
function updateUI() {
    document.getElementById('turn').textContent = `${gameState.quartersElapsed} / ${MAX_QUARTERS}`;
    for (const key in indicatorsMap) {
        const element = document.getElementById(indicatorsMap[key]);
        let value = gameState[key];
        let displayValue = '';
        if (key === 'stability') displayValue = Math.round(value);
        else if (key === 'nationalDebt') displayValue = `$${value.toFixed(1)}T`;
        else if (key === 'fedRate' || key === 'bondYield') displayValue = `${value.toFixed(2)}%`;
        else displayValue = `${value.toFixed(1)}%`;
        if (element) element.textContent = displayValue;
    }
}

function displayChanges(initialState) {
    for (const key in indicatorsMap) {
        const diff = gameState[key] - initialState[key];
        const changeElement = document.getElementById(`${indicatorsMap[key]}-change`);
        if (!changeElement) continue;
        let formattedDiff = '';
        if (Math.abs(diff) < 0.01) {
            changeElement.className = 'stat-change neutral-change';
            changeElement.textContent = '';
            continue;
        }
        const sign = diff > 0 ? '+' : '';
        if (key === 'stability') formattedDiff = `${sign}${Math.round(diff)}`;
        else if (key === 'nationalDebt') formattedDiff = `${sign}${diff.toFixed(2)}T`;
        else formattedDiff = `${sign}${diff.toFixed(2)}%`;
        changeElement.textContent = formattedDiff;
        changeElement.className = diff > 0 ? 'stat-change positive-change' : 'stat-change negative-change';
    }
}

// --- CORE SIMULATION ENGINE ---
function runQuarterSimulation(policy) {
    const pFedRate = policy.fedRate ?? gameState.fedRate;
    const pTariffs = policy.tariffs ?? gameState.tariffs;
    const pFiscal = policy.fiscal ?? 0;

    gameState.fedRate = pFedRate;
    gameState.tariffs = pTariffs;
    
    let unemploymentChange = (pFedRate - 4.5) * 0.4;
    unemploymentChange -= pFiscal / 200;
    gameState.unemployment += unemploymentChange;
    
    let inflationChange = (4.0 - gameState.unemployment) * 0.5;
    inflationChange -= (pFedRate - 4.0) * 0.3;
    gameState.inflation += inflationChange + (gameState.inflation - 2.0) * 0.1;

    // ** FINAL CALIBRATION TO GDP FORMULA **
    gameState.gdpGrowth = 3.3 - (gameState.unemployment * 0.4) + (pFiscal / 400); // Was 3.0

    const debtRiskPremium = Math.max(0, (gameState.nationalDebt - 35) * 0.1);
    const inflationRiskPremium = Math.max(0, (gameState.inflation - 2.0) * 0.3);
    gameState.bondYield = gameState.fedRate * 0.8 + 1.25 + debtRiskPremium + inflationRiskPremium;

    gameState.unemployment = Math.max(2.5, gameState.unemployment);
    gameState.inflation = Math.max(-2.0, gameState.inflation);

    const gdpInTrillions = 28 + (gameState.gdpGrowth / 100 * 28);
    const taxRevenue = gdpInTrillions * 0.18;
    const interestPayments = gameState.nationalDebt * (gameState.bondYield / 100);
    const yearlyDeficit = (interestPayments + 6.5) - (taxRevenue + 1.0) - (pFiscal / 1000);
    gameState.nationalDebt += yearlyDeficit / 4;

    let stabilityChange = 0;
    stabilityChange += gameState.gdpGrowth;
    stabilityChange -= Math.abs(gameState.inflation - 2.0) * 1.5;
    stabilityChange -= Math.max(0, gameState.unemployment - 5.0) * 1.5;
    stabilityChange -= Math.max(0, gameState.nationalDebt - 40) * 0.5;
    gameState.stability += stabilityChange;

    gameState.quartersElapsed++;
}

// --- GAME FLOW & LOGIC ---
function runSimulation(numQuarters) {
    if (gameState.gameOver || gameState.quartersElapsed + numQuarters > MAX_QUARTERS) return;
    
    const initialState = { ...gameState };
    const policy = {
        fedRate: parseFloat(document.getElementById('fed-rate-input').value),
        tariffs: parseFloat(document.getElementById('tariffs-input').value),
        fiscal: parseFloat(document.getElementById('fiscal-input').value)
    };
    
    for (let i = 0; i < numQuarters; i++) {
        if (gameState.gameOver) break;
        runQuarterSimulation(policy);
        checkWinLossCondition();
    }
    
    updateUI();
    displayChanges(initialState);
    generateOutlook();
    generateAlerts();
    if (!gameState.gameOver) generateHints();
}

function checkWinLossCondition() {
    // ** REFINED WIN CONDITION **
    const isWin = gameState.inflation <= 3.0 && gameState.inflation >= 1.5 && gameState.unemployment <= 5.0 && gameState.gdpGrowth >= 1.5;
    const isTimeLoss = gameState.quartersElapsed >= MAX_QUARTERS && !isWin;

    if (isWin) {
        gameState.gameOver = true;
        const quartersRemaining = MAX_QUARTERS - gameState.quartersElapsed;
        // ** NEW REWARDING SCORE CALCULATION **
        let finalScore = 100;
        finalScore -= Math.abs(gameState.inflation - 2.0) * 10; // Penalty for missing 2% inflation target
        finalScore -= Math.max(0, gameState.unemployment - 4.0) * 10; // Penalty for missing 4% unemployment target
        finalScore += gameState.gdpGrowth * 5; // Bonus for strong growth
        finalScore += quartersRemaining * 10; // Bonus for finishing early
        
        document.getElementById('stability').textContent = Math.round(finalScore);
        document.getElementById('outlook-text').innerHTML = `<strong>Congratulations, you've stabilized the economy!</strong><br>You achieved a soft landing in ${gameState.quartersElapsed} quarters. <br><strong>Final Score: ${Math.round(finalScore)}</strong>`;
        endGame();
    } else if (isTimeLoss) {
        gameState.gameOver = true;
        document.getElementById('outlook-text').innerHTML = `<strong>Challenge Failed.</strong><br>You ran out of time to stabilize the economy. The crisis continues.`;
        endGame();
    }
}

function endGame() {
    const buttons = document.querySelectorAll('.actions-panel button, .header-buttons button');
    buttons.forEach(btn => btn.disabled = true);
    document.getElementById('hints-text').innerHTML = '<strong>Game Over.</strong> Thank you for playing.';
    document.getElementById('alerts-text').innerHTML = '';
}

function generateOutlook() { /* ... unchanged ... */ }
function generateAlerts() { /* ... unchanged ... */ }
function generateHints() { /* ... unchanged ... */ }
function setupModal(modalId, btnId, closeBtnId) { /* ... unchanged ... */ }
function populateCheatSheet() { /* ... unchanged ... */ }
function applyRecommendedPolicy() { /* ... unchanged ... */ }
async function autopilotToVictory() { /* ... unchanged ... */ }

// --- INITIALIZE ---
document.addEventListener('DOMContentLoaded', () => {
    // Re-pasting full functions to prevent scope/definition issues
    window.generateOutlook = function() {
        if (gameState.gameOver) return;
        let outlook = "";
        const timeFrame = "Following the most recent quarter, the ";
        if (gameState.gdpGrowth > 3.0) outlook += `${timeFrame}US economy is experiencing strong expansion, `;
        else if (gameState.gdpGrowth > 1.5) outlook += `${timeFrame}economy is showing moderate growth, `;
        else if (gameState.gdpGrowth >= 0) outlook += `${timeFrame}economic growth has become sluggish, `;
        else outlook += `${timeFrame}economy has entered a recession, `;

        if (gameState.unemployment < 4.0) outlook += "with a very tight labor market. ";
        else if (gameState.unemployment < 5.0) outlook += "and the labor market remained solid. ";
        else outlook += "but there is notable slack in the labor market. ";
        
        if (gameState.inflation > 5.0) outlook += "However, inflation has accelerated to alarming levels. ";
        else if (gameState.inflation > 2.5) outlook += "Inflationary pressures are building and remain a key concern. ";
        else if (gameState.inflation >= 1.5) outlook += "Inflation is settling into the target range. ";
        else outlook += "There are emerging risks of deflation, which could stifle spending. ";
        
        document.getElementById('outlook-text').textContent = outlook;
    };
    window.generateAlerts = function() {
        if (gameState.gameOver) return;
        const alerts = [];
        if (gameState.stability < 25) alerts.push("CRITICAL ALERT: Economic stability is collapsing. The nation is in a deep depression. Recovery is highly unlikely.");
        if (gameState.gdpGrowth < 0.5 && gameState.inflation > 4.0) alerts.push("Stagflation Warning: High inflation combined with low or negative growth is crippling the economy.");
        if (gameState.inflation > 5.0 && gameState.fedRate < 4.0) alerts.push("Policy Alert: The Federal Funds Rate appears too low to effectively combat severe inflation.");
        if (gameState.inflation < 1.0 && gameState.fedRate > 3.0) alerts.push("Policy Alert: The Federal Funds Rate may be unnecessarily restrictive, increasing the risk of a deflationary spiral.");
        if (gameState.nationalDebt > 50) alerts.push("Debt Crisis: The national debt has reached critical levels, stressing fiscal stability.");

        const alertsDiv = document.getElementById('alerts-text');
        if (alerts.length > 0) {
            alertsDiv.innerHTML = "<ul>" + alerts.map(a => `<li>${a}</li>`).join('') + "</ul>";
        } else {
            alertsDiv.innerHTML = "<p>No alerts at this time. Economic conditions appear stable and consistent.</p>";
        }
    };
    window.generateHints = function() {
        let hint = "";
        const { inflation, unemployment, gdpGrowth } = gameState;
        if (inflation > 4.0) hint = "Inflation is the primary threat. Consider raising the Federal Funds Rate to reduce price pressures, even if it slows the economy in the short term.";
        else if (unemployment > 6.0) hint = "Unemployment is very high. Consider lowering the Federal Funds Rate or using fiscal stimulus to boost job growth.";
        else if (gdpGrowth < 1.0) hint = "The economy is stagnating. Stimulative policies are needed to encourage growth and investment.";
        else if (inflation > 3.0) hint = "You're getting closer, but inflation is still above the target range. A moderately restrictive policy might be needed.";
        else if (unemployment > 5.0) hint = "The job market still has room to improve. Ensure policy isn't too restrictive to allow for further recovery.";
        else hint = "The economy is nearing the stability targets. Maintain a balanced approach to achieve the final goal.";
        document.getElementById('hints-text').textContent = "Hint: " + hint;
    };
    window.setupModal = function(modalId, btnId, closeBtnId) {
        const modal = document.getElementById(modalId);
        const btn = document.getElementById(btnId);
        const span = document.getElementById(closeBtnId);
        btn.onclick = function() { modal.style.display = "block"; }
        span.onclick = function() { modal.style.display = "none"; }
        window.onclick = function(event) { if (event.target == modal) { modal.style.display = "none"; } }
    };
    window.populateCheatSheet = function() {
        const table = document.getElementById('cheat-sheet-table');
        let tableHTML = "<thead><tr><th>Quarter</th><th>Fed Rate</th><th>Fiscal Adj. ($B)</th><th>Tariffs</th><th>Note</th></tr></thead><tbody>";
        cheatSheet.forEach(row => {
            tableHTML += `<tr><td>${row.quarter}</td><td>${row.fedRate.toFixed(2)}%</td><td>${row.fiscal}</td><td>${row.tariffs.toFixed(1)}%</td><td>${row.note}</td></tr>`;
        });
        tableHTML += "</tbody>";
        table.innerHTML = tableHTML;
    };
    window.applyRecommendedPolicy = function() {
        if (gameState.gameOver) return;
        const currentHint = cheatSheet[gameState.quartersElapsed];
        if (currentHint) {
            document.getElementById('fed-rate-input').value = currentHint.fedRate.toFixed(2);
            document.getElementById('tariffs-input').value = currentHint.tariffs.toFixed(1);
            document.getElementById('fiscal-input').value = currentHint.fiscal;
        }
    };
    window.autopilotToVictory = async function() {
        const buttons = document.querySelectorAll('.actions-panel button, .header-buttons button');
        buttons.forEach(btn => btn.disabled = true);

        while(gameState.quartersElapsed < MAX_QUARTERS && !gameState.gameOver) {
            const policy = cheatSheet[gameState.quartersElapsed];
            const initialState = { ...gameState };
            runQuarterSimulation(policy);
            checkWinLossCondition();
            updateUI();
            displayChanges(initialState);
            generateOutlook();
            generateAlerts();
            if (!gameState.gameOver) generateHints();
            await new Promise(resolve => setTimeout(resolve, 750));
        }
        if(!gameState.gameOver) { buttons.forEach(btn => btn.disabled = false); }
    };
    
    updateUI();
    setupModal('rules-modal', 'how-to-play-btn', 'rules-close-btn');
    setupModal('cheat-modal', 'cheat-btn', 'cheat-close-btn');
    populateCheatSheet();
    document.getElementById('autopilot-quarter-btn').addEventListener('click', () => {
        applyRecommendedPolicy();
        runSimulation(1);
    });
    document.getElementById('autopilot-victory-btn').addEventListener('click', autopilotToVictory);
});
</script>

<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
particlesJS("particles-js", {
  "particles": { "number": { "value": 80, "density": { "enable": true, "value_area": 800 }}, "color": { "value": "#ffffff" }, "shape": { "type": "circle" }, "opacity": { "value": 0.5, "random": false }, "size": { "value": 3, "random": true }, "line_linked": { "enable": true, "distance": 150, "color": "#ffffff", "opacity": 0.4, "width": 1 }, "move": { "enable": true, "speed": 2, "direction": "none", "random": false, "straight": false, "out_mode": "out", "bounce": false }},
  "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false }, "onclick": { "enable": false }, "resize": true }},
  "retina_detect": true
});
</script>
</body>
</html>